<h1>Welcome <%= @user.username %></h1>

<%= render 'application/message' %>

<div id="ui_buttons">
  <%= button_tag "View All Trails", id: "trails" %>
  <%= button_tag "View Trails You've Created", id: "user-trails" %>
  <%= button_tag 'View Your Trail Ratings', id: "user-trail-ratings" %>
  <%= button_tag 'Add a New Trail', id: "add-trail" %>
  <%= button_tag 'Add a Trail Rating', id: "add-trail-rating" %>
</div>
<br>

<div id="all_trails" class="hidden">
</div>

<div id="user_created_trails" class="hidden">
  <% @user.created_trails.each do |tr| %>
      <strong>Name: </strong>
      <br>
      <%= tr.name %>
      <br>
      <br>
      <strong>Length: </strong>
      <br>
      <%= tr.length %>
      <br>
  <% end %>
</div>

<div id="user_tr_display" class="hidden">
  <% if @user.trail_ratings.blank? %>
    <h3>You have no trails currently listed.</h3>
  <% end %>

  <% @user.trail_ratings.each do |tr| %>
    <% if tr.trail != nil %>
      <strong>Name: </strong>
      <br>
      <%= tr.trail.name %>
      <br>
      <br>
      <strong>Length: </strong>
      <br>
      <%= tr.trail.length %>
      <br>
      <br>
      <strong>Your Rating: </strong>
      <br>
      <%= tr.rating %>
      <br>
      <br>
      <% if validate_user %>
        <%= link_to "Edit This Trail Rating", edit_trail_rating_path(tr) %>
        <br>
        <%= link_to "Delete This Trail Rating", tr, method: :delete, data: { confirm: "Are you sure?" } %>  
      <% end %>
      <br>
      <br>
      <hr>
    <% end %>
  <% end %>
</div>

<div id="trail_form" class="hidden">
  <% if validate_user %>
    <%= render 'trails/form' %>
  <% end %>
</div>

<div id="trail_ratings_form" class="hidden">
  <% if validate_user %>
  <% if @user.unowned_trails.size > 0 %>
    <p>Add a new trail and rating to your collection</p>

    <%= form_for @trail_rating do |f| %>
      <%= f.hidden_field :user_id, value: @user.id %>
      <%= f.label "Select Trail: " %>
      <br>
      <%= f.collection_select :trail_id, @user.unowned_trails, :id, :name %>
      <br>
      <br>
      <%= f.label "Select Personal Rating: " %>
      <br>
      <%= f.select "rating", options_for_select(1..5, 3) %>
      <br>
      <br>
      <%= f.submit %>

      <% end %>
    <% else %>
      <h4>Sorry, you have rated all the trails in our system!</h4>
    <% end %>
  <% end %>
</div>

<script type="text/javascript" charset="utf-8">
  $(function(){

    $('#trails').click(function(e){
      $.get('/trails.json', function(data){
        $('#all_trails').html(' ')
        data.forEach(function(trail){
          $('#all_trails').append(
            `
            <p><strong>Name: </strong>${trail.name}</p>
            <div id="trail-info-${trail.id}">
            <a href="#" id="trail-${trail.id}" data-trail="${trail.id}" class="trail-details" >View ${trail.name} Trail Info</a>
            </div>
            <br>
            `
          )
        })
        trailDetails()
      })

      if ($(this).text() === "View All Trails") {
        $(this).text("Hide All Trails")
        $('#all_trails').removeClass('hidden')
      } else {
        $(this).text("View All Trails")
        $('#all_trails').addClass('hidden')
      }
    })

    toggleDisplay('#user-trails', "View Trails You've Created", "Hide Your Trails", '#user_created_trails')

    toggleDisplay('#user-trail-ratings', "View Your Trail Ratings", "Hide Your Trail Ratings", '#user_tr_display')

    toggleDisplay('#add-trail', "Add a New Trail", "Hide New Trail Form", '#trail_form')

    toggleDisplay('#add-trail-rating', "Add a Trail Rating", "Hide Trail Rating Form", '#trail_ratings_form')

    $('a.trail-details').click(function(e){
      console.log(this)
      e.preventDefault()
    })

  })
</script>